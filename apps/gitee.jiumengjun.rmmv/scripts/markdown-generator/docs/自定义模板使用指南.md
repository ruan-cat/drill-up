# jsdoc2md 自定义模板使用指南

## 问题描述

使用 jsdoc2md 默认模板时，返回类型会被渲染为带链接的 Markdown 格式：
```markdown
## allocate() ⇒ [<code>CacheEntry</code>](#CacheEntry)
```

这种格式在某些场景（如 VitePress）中会导致渲染问题。我们需要的是不带链接的简洁格式：
```markdown
## allocate() ⇒ <code>CacheEntry</code>
```

## 解决方案

### 1. 自定义模板文件

本项目已创建了以下自定义模板文件：

- `partials/shared/signature/sig-link-no-anchor.hbs` - 不带链接的签名模板
- `partials/shared/value/linked-type-list-no-anchor.hbs` - 不带链接的类型列表模板  
- `partials/shared/value/link-no-anchor.hbs` - 不带链接的单个链接模板

### 2. 使用方法

#### 方法一：通过 partial 选项自定义特定模板

```javascript
const jsdoc2md = require('jsdoc-to-markdown');

const output = await jsdoc2md.render({
  files: 'src/**/*.js',
  // 使用自定义的 partial 模板
  partial: [
    'node_modules/dmd/partials/shared/signature/sig-link-no-anchor.hbs',
    'node_modules/dmd/partials/shared/value/linked-type-list-no-anchor.hbs', 
    'node_modules/dmd/partials/shared/value/link-no-anchor.hbs'
  ],
  // 重写默认的 partial 映射
  'partial-names': {
    'sig-link': 'sig-link-no-anchor',
    'linked-type-list': 'linked-type-list-no-anchor',
    'link': 'link-no-anchor'
  }
});
```

#### 方法二：创建自定义 dmd 配置

创建一个自定义的模板配置文件 `custom-dmd-config.json`：

```json
{
  "partial": [
    "./partials/shared/signature/sig-link-no-anchor.hbs",
    "./partials/shared/value/linked-type-list-no-anchor.hbs",
    "./partials/shared/value/link-no-anchor.hbs"
  ],
  "partial-names": {
    "sig-link": "sig-link-no-anchor", 
    "linked-type-list": "linked-type-list-no-anchor",
    "link": "link-no-anchor"
  }
}
```

然后在代码中使用：

```javascript
const jsdoc2md = require('jsdoc-to-markdown');
const dmdConfig = require('./custom-dmd-config.json');

const output = await jsdoc2md.render({
  files: 'src/**/*.js',
  ...dmdConfig
});
```

#### 方法三：本地复制自定义模板

如果你想要完全控制模板，可以将整个 dmd 模板复制到项目中：

```bash
# 复制整个 dmd 模板到项目
cp -r node_modules/dmd/partials ./custom-templates/

# 然后修改你需要的模板文件
```

在代码中使用：

```javascript
const jsdoc2md = require('jsdoc-to-markdown');

const output = await jsdoc2md.render({
  files: 'src/**/*.js',
  template: './custom-templates/main.hbs',
  partial: './custom-templates/**/*.hbs'
});
```

### 3. 模板修改说明

#### sig-link-no-anchor.hbs
移除了原有的 `[...](...) ` Markdown 链接语法，只保留 `<code>` 标签包裹的内容。

#### linked-type-list-no-anchor.hbs  
使用 `link-no-anchor` partial 替代原有的 `link` partial。

#### link-no-anchor.hbs
始终只输出 `<code>name</code>` 格式，无论是否有链接 URL。

### 4. 验证效果

使用自定义模板后，输出将从：
```markdown
## allocate() ⇒ [<code>CacheEntry</code>](#CacheEntry)
```

变为：
```markdown  
## allocate() ⇒ <code>CacheEntry</code>
```

### 5. 注意事项

1. **兼容性**：确保 jsdoc-to-markdown 版本支持 `partial-names` 选项
2. **路径处理**：模板路径需要根据你的项目结构进行调整
3. **缓存**：修改模板后可能需要清理 jsdoc2md 的缓存
4. **测试**：建议在小范围测试后再应用到整个项目

### 6. 完整示例

```javascript
const jsdoc2md = require('jsdoc-to-markdown');
const path = require('path');

async function generateDocs() {
  try {
    const output = await jsdoc2md.render({
      files: 'src/**/*.js',
      partial: [
        path.join(__dirname, 'partials/shared/signature/sig-link-no-anchor.hbs'),
        path.join(__dirname, 'partials/shared/value/linked-type-list-no-anchor.hbs'),
        path.join(__dirname, 'partials/shared/value/link-no-anchor.hbs')
      ],
      'partial-names': {
        'sig-link': 'sig-link-no-anchor',
        'linked-type-list': 'linked-type-list-no-anchor', 
        'link': 'link-no-anchor'
      }
    });
    
    console.log('Generated documentation:', output);
    return output;
  } catch (error) {
    console.error('Error generating documentation:', error);
  }
}

generateDocs();
```

通过以上配置，你就可以获得不带链接锚点的干净 Markdown 输出格式了。