# ğŸ® TypeScript RPGMV æ’ä»¶å¼€å‘ç¯å¢ƒ

## ğŸ¯ é¡¹ç›®æ”¹è¿›æ¦‚è¿°

æœ¬é¡¹ç›®å·²å®Œæˆä» JavaScript åˆ° TypeScript çš„ RPGMV æ’ä»¶å¼€å‘ç¯å¢ƒå‡çº§ï¼Œå®ç°äº†ç°ä»£åŒ–çš„ç±»å‹å®‰å…¨æ’ä»¶å¼€å‘æµç¨‹ã€‚

## âœ¨ ä¸»è¦æ”¹è¿›

### 1. ç±»å‹å®‰å…¨ä¼˜åŒ–

- âœ… å¤ç”¨ç°æœ‰çš„å®Œæ•´ RPGMV ç±»å‹å£°æ˜
- âœ… ä¼˜åŒ– `global.d.ts`ï¼Œæ›¿æ¢ `any` ç±»å‹ä¸ºå…·ä½“ç±»å‹
- âœ… å®Œæ•´çš„ TypeScript ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥

### 2. ç°ä»£åŒ–å¼€å‘æµç¨‹

- âœ… TypeScript æºç ï¼š`src/rpgmv-plugins/`
- âœ… è‡ªåŠ¨æ„å»ºè¾“å‡ºï¼š`drill-project/js/plugins/`
- âœ… é…ç½®åŒ–æ„å»ºï¼š`tsup.config.ts`
- âœ… çƒ­é‡è½½å¼€å‘æ¨¡å¼

### 3. å¢å¼ºçš„å¼€å‘ä½“éªŒ

```bash
# ğŸš€ é›¶é…ç½®å¼€å‘å¯åŠ¨ï¼ˆè‡ªåŠ¨æ„å»ºæ’ä»¶ï¼‰
pnpm run dev:drill

# ğŸ”„ ç›‘å¬æ¨¡å¼æ„å»ºæ’ä»¶
pnpm run build:rpgmv-plugins:watch

# ğŸ”¨ æ‰‹åŠ¨æ„å»ºæ‰€æœ‰æ’ä»¶
pnpm run build:rpgmv-plugins
```

## ğŸ“ æ–‡ä»¶ç»“æ„å¯¹æ¯”

### ä¹‹å‰ (JavaScript)

```plain
drill-project/js/plugins/
â””â”€â”€ VueBridge.js  âŒ æ‰‹åŠ¨ç¼–å†™JSï¼Œç¼ºä¹ç±»å‹å®‰å…¨
```

### ç°åœ¨ (TypeScript)

```plain
src/rpgmv-plugins/
â””â”€â”€ VueBridge.ts  âœ… TypeScriptæºç ï¼Œç±»å‹å®‰å…¨

drill-project/js/plugins/
â””â”€â”€ VueBridge.js  âœ… è‡ªåŠ¨ç¼–è¯‘ç”Ÿæˆï¼ŒES5å…¼å®¹
```

## ğŸ”§ æŠ€æœ¯æ ˆ

| æŠ€æœ¯       | ç”¨é€”         | ç‰ˆæœ¬       |
| ---------- | ------------ | ---------- |
| TypeScript | æ’ä»¶æºç è¯­è¨€ | æœ€æ–°       |
| tsup       | æ’ä»¶æ„å»ºå·¥å…· | v8.5.0     |
| Vite       | è‡ªåŠ¨æ„å»ºé›†æˆ | v5.4.1     |
| ES5        | ç›®æ ‡å…¼å®¹æ€§   | RPGMV å…¼å®¹ |
| IIFE       | è¾“å‡ºæ ¼å¼     | æ’ä»¶æ ‡å‡†   |

## ğŸš€ é›¶é…ç½®è‡ªåŠ¨æ„å»ºç³»ç»Ÿ

### ğŸ¯ æ–°ç‰¹æ€§äº®ç‚¹

é¡¹ç›®ç°å·²é›†æˆ **Vite è‡ªåŠ¨æ„å»ºæ’ä»¶**ï¼Œå®ç°äº†ä»¥ä¸‹çªç ´æ€§æ”¹è¿›ï¼š

```mermaid
graph LR
    A[å¯åŠ¨å¼€å‘] --> B[è‡ªåŠ¨æ£€æµ‹æ’ä»¶]
    B --> C[æ™ºèƒ½æ„å»ºå†³ç­–]
    C --> D[tsup ç¼–ç¨‹å¼æ„å»º]
    D --> E[Vite å¼€å‘æœåŠ¡å™¨]

    F[æ–‡ä»¶å˜åŒ–] --> G[HMR æ£€æµ‹]
    G --> H[è‡ªåŠ¨é‡æ„å»º]
    H --> I[çƒ­é‡è½½å®Œæˆ]
```

#### âœ¨ æ ¸å¿ƒä¼˜åŠ¿

- **ğŸ”¥ é›¶å¯åŠ¨æˆæœ¬**ï¼š`pnpm run dev:drill` ä¸€é”®å¯åŠ¨
- **ğŸ§  æ™ºèƒ½æ„å»º**ï¼šä»…åœ¨éœ€è¦æ—¶æ„å»ºï¼Œé¿å…é‡å¤æ“ä½œ
- **âš¡ çƒ­é‡è½½æ”¯æŒ**ï¼šTypeScript æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡æ–°æ„å»º
- **ğŸ›¡ï¸ é”™è¯¯å¤„ç†**ï¼šå‹å¥½çš„æ„å»ºå¤±è´¥æç¤º
- **ğŸ“¦ ç”Ÿäº§å°±ç»ª**ï¼šæ„å»ºå‘½ä»¤åŒæ ·è‡ªåŠ¨å¤„ç†

### ğŸ“‹ è‡ªåŠ¨æ„å»ºå·¥ä½œæµç¨‹

#### å¼€å‘æ¨¡å¼ (Development)

1. è¿è¡Œ `pnpm run dev:drill`
2. Vite æ’ä»¶æ£€æŸ¥æ’ä»¶æ˜¯å¦éœ€è¦æ„å»º
3. è°ƒç”¨ tsup çš„ `build()` å‡½æ•°è¿›è¡Œæ„å»º
4. å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨
5. ç›‘å¬ `src/rpgmv-plugins/` æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡æ–°æ„å»º

#### ç”Ÿäº§æ¨¡å¼ (Production)

1. è¿è¡Œ `pnpm run build:drill`
2. æ„å»ºå‰è‡ªåŠ¨å¤„ç† RPGMV æ’ä»¶
3. ç»§ç»­ Vue åº”ç”¨çš„ç”Ÿäº§æ„å»º

## ğŸ¯ å¼€å‘æµç¨‹

### å¼€å‘æ–°æ’ä»¶ï¼ˆğŸ†• ç®€åŒ–æµç¨‹ï¼‰

1. åœ¨ `src/rpgmv-plugins/` åˆ›å»º `.ts` æ–‡ä»¶
2. åœ¨ `tsup.config.ts` æ·»åŠ å…¥å£é…ç½®
3. **ç›´æ¥è¿è¡Œ `pnpm run dev:drill`** âœ¨ (è‡ªåŠ¨æ„å»º!)
4. åœ¨ `index.html` å¼•ç”¨ç”Ÿæˆçš„ `.js` æ–‡ä»¶

### ä¿®æ”¹ç°æœ‰æ’ä»¶ï¼ˆğŸ†• çƒ­é‡è½½ï¼‰

1. ç¼–è¾‘ `src/rpgmv-plugins/VueBridge.ts`
2. **ä¿å­˜æ–‡ä»¶å³å¯** âœ¨ (è‡ªåŠ¨é‡æ–°æ„å»º!)
3. æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°æŸ¥çœ‹æ•ˆæœ

## ğŸ“Š æ„å»ºé…ç½®ç‰¹æ€§

### è¾“å‡ºä¼˜åŒ–

- **æ ¼å¼**: IIFE (ç«‹å³æ‰§è¡Œå‡½æ•°)
- **ç›®æ ‡**: ES5 (RPGMV å…¼å®¹)
- **å‹ç¼©**: å¯é…ç½® (å½“å‰å…³é—­ä¿æŒå¯è¯»æ€§)
- **Source Maps**: å…³é—­

### å¤–éƒ¨ä¾èµ–

è‡ªåŠ¨æ’é™¤ RPGMV å…¨å±€å¯¹è±¡ï¼Œé¿å…é‡å¤æ‰“åŒ…ï¼š

- `$gameVariables`, `$gameSwitches`, `$gameMessage`
- `SceneManager`, `AudioManager`
- `Scene_Boot`, `Game_Actor`

### æ„å»ºæ¨ªå¹…

è‡ªåŠ¨æ·»åŠ æ„å»ºä¿¡æ¯ï¼š

```javascript
//=============================================================================
// VueBridge.js - ç”±TypeScriptç¼–è¯‘ç”Ÿæˆ
// Vueä¸RPGMVåŒå‘é€šä¿¡æ¡¥æ¥æ’ä»¶
// ç¼–è¯‘æ—¶é—´: 2025-07-31T09:40:10.358Z
//=============================================================================
```

## ğŸ” ç±»å‹å®‰å…¨ç¤ºä¾‹

### ä¹‹å‰ (any ç±»å‹)

```typescript
// âŒ ç¼ºä¹ç±»å‹å®‰å…¨
$gameVariables: any;
$gameSwitches: any;
SceneManager: any;
```

### ç°åœ¨ (å…·ä½“ç±»å‹)

```typescript
// âœ… å®Œæ•´ç±»å‹å®‰å…¨
$gameVariables: Game_Variables;
$gameSwitches: Game_Switches;
SceneManager: SceneManagerStatic;

// âœ… ç±»å‹å®‰å…¨çš„APIè°ƒç”¨
$gameVariables.setValue(1, "Hello World");
$gameSwitches.setValue(1, true);

const audio: MV.AudioParameters = {
	name: "Decision1",
	volume: 90,
	pitch: 100,
	pan: 0,
	pos: 0,
};
AudioManager.playSe(audio);
```

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [TypeScript æ’ä»¶å¼€å‘æŒ‡å—](./docs/typescript-plugin-development.md) - è¯¦ç»†å¼€å‘æŒ‡å—
- [Vue ä¸ RPGMV åŒå‘é€šä¿¡ç³»ç»Ÿ](./docs/vue-rpgmv-communication.md) - é€šä¿¡ç³»ç»Ÿæ–‡æ¡£

## ğŸ‰ ä½¿ç”¨å»ºè®®

### æ¨èå¼€å‘æµç¨‹ï¼ˆğŸ†• æç®€ç‰ˆï¼‰

```bash
# ğŸš€ ä¸€é”®å¯åŠ¨ - è‡ªåŠ¨æ„å»ºæ’ä»¶å¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm run dev:drill

# å°±è¿™ä¹ˆç®€å•ï¼æ— éœ€é¢å¤–é…ç½®æˆ–è„šæœ¬ âœ¨
```

### é«˜çº§å¼€å‘æ¨¡å¼

```bash
# å¦‚æœéœ€è¦å•ç‹¬ç›‘å¬æ’ä»¶å˜åŒ–ï¼ˆä¸€èˆ¬ä¸éœ€è¦ï¼‰
pnpm run build:rpgmv-plugins:watch
```

### ç”Ÿäº§ç¯å¢ƒæ„å»º

```bash
# ç”Ÿäº§æ„å»º - è‡ªåŠ¨æ„å»ºæ’ä»¶ç„¶åæ„å»ºVueåº”ç”¨
pnpm run build:drill
```

## ğŸš€ ç«‹å³å¼€å§‹

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ç°ä»£åŒ–çš„ TypeScript å¼€å‘ç¯å¢ƒï¼š

```bash
cd apps/drill
pnpm run dev:drill
```

**å°±è¿™ä¸€æ¡å‘½ä»¤ï¼** ğŸ¯

ç°åœ¨ä½ å¯ä»¥äº«å—ï¼š

- âœ… ç±»å‹å®‰å…¨çš„ RPGMV æ’ä»¶å¼€å‘
- âœ… è‡ªåŠ¨æ„å»ºå’Œçƒ­é‡è½½
- âœ… é›¶é…ç½®çš„å¼€å‘ä½“éªŒ
- âœ… ç°ä»£åŒ–çš„å·¥å…·é“¾

ğŸ®âœ¨ **å¼€å‘ä»æœªå¦‚æ­¤ç®€å•ï¼**
